<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Work Pro Israel - Safety Edition</title>
    <style>
        :root { --bg: #f0f2f5; --card-bg: #ffffff; --primary: #4e73df; --success: #1cc88a; --danger: #e74a3b; --text-main: #2e3440; --text-sub: #858796; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding: 20px 15px; }
        .container { max-width: 480px; margin: 0 auto; }
        .card { background: var(--card-bg); border-radius: 18px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.04); margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.02); }
        .card-title { font-size: 0.75rem; font-weight: 800; color: var(--text-sub); text-transform: uppercase; margin-bottom: 12px; display: block; letter-spacing: 0.5px; }
        input { background: #f8f9fc; border: 1px solid #d1d3e2; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box; font-size: 1rem; margin-bottom: 10px; }
        .net-card { background: linear-gradient(135deg, #1a1c23, #2d3436); color: white; padding: 25px; border-radius: 22px; text-align: center; }
        .net-amount { font-size: 2.8rem; font-weight: 800; color: #00ff88; display: block; margin: 10px 0; }
        .timer-display { font-size: 3.2rem; font-weight: 800; text-align: center; margin: 15px 0; color: var(--primary); font-family: monospace; }
        .btn { padding: 16px; border: none; border-radius: 12px; font-weight: 700; width: 100%; cursor: pointer; margin-bottom: 10px; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: none; border: 1px solid var(--text-sub); color: var(--text-sub); padding: 10px; font-size: 0.8rem; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 0.7rem; color: var(--text-sub); padding: 10px; border-bottom: 1px solid #eaecf4; }
        td { padding: 12px 10px; font-size: 0.85rem; border-bottom: 1px solid #f8f9fc; }
    </style>
</head>
<body>

<div class="container">
    <div class="card" style="border-left: 5px solid var(--primary);">
        <span class="card-title">üìÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
        <input type="month" id="monthFilter" onchange="renderData()">
    </div>

    <div class="net-card">
        <span style="opacity: 0.7; font-size: 0.9rem;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Pay)</span>
        <span class="net-amount">‚Ç™ <span id="netDisplay">0</span></span>
        <div style="display: flex; justify-content: space-around; font-size: 0.8rem; opacity: 0.9; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
            <div>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°: <b id="totalHDisplay">0</b></div>
            <div>‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏Å: <b id="grossDisplay">0</b></div>
        </div>
        <button onclick="copySummary()" style="background:rgba(255,255,255,0.1); border:none; color:white; padding:5px 10px; border-radius:5px; font-size:0.7rem; margin-top:10px; cursor:pointer;">üìã ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏™‡πà‡∏á LINE</button>
    </div>

    <div class="card" style="margin-top: 15px;">
        <span class="card-title">üïí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
        <input type="date" id="currentDate">
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        <button id="startBtn" class="btn btn-success" onclick="startWork()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
        <button id="endBtn" class="btn btn-danger" style="display:none;" onclick="endWork()">‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô (‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏Å 30‡∏ô.)</button>
    </div>

    <div class="card" style="background:#fdfdfd; border: 1px dashed #d1d3e2;">
        <span class="card-title">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</span>
        <input type="date" id="manualDate">
        <div class="grid-2">
            <div><label style="font-size:0.65rem;">‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="time" id="timeIn" value="06:00"></div>
            <div><label style="font-size:0.65rem;">‡πÄ‡∏•‡∏¥‡∏Å</label><input type="time" id="timeOut" value="17:00"></div>
        </div>
        <label style="font-size:0.65rem;">‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å (‡∏ä‡∏°.)</label>
        <input type="number" id="manualBreak" value="0.5" step="0.1">
        <button class="btn btn-primary" onclick="saveManual()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <div class="card">
        <span class="card-title">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
        <div class="grid-2">
            <div><label style="font-size: 0.65rem;">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏°.</label><input type="number" id="rate" value="38" oninput="renderData()"></div>
            <div><label style="font-size: 0.65rem;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</label><input type="number" id="bonus" value="0" oninput="renderData()"></div>
        </div>
        <label style="font-size: 0.65rem;">‡∏¢‡∏≠‡∏î‡∏´‡∏±‡∏Å‡∏£‡∏ß‡∏°</label>
        <input type="number" id="totalDeduction" value="0" oninput="renderData()">
    </div>

    <div class="card" style="padding: 10px; overflow-x: auto;">
        <table>
            <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏°.</th><th>‡∏õ‡∏Å‡∏ï‡∏¥</th><th>‡πÇ‡∏≠‡∏ó‡∏µ</th><th>‡∏£‡∏ß‡∏°</th><th></th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
        <button onclick="backupData()" class="btn btn-outline">üì• ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÇ‡∏ô‡πâ‡∏ï</button>
        <button onclick="restoreData()" class="btn btn-outline">üì§ ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
    <button onclick="clearSystem()" style="width:100%; background:none; color:#ccc; border:none; padding: 20px; font-size: 0.7rem;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<script>
    const now = new Date();
    document.getElementById('monthFilter').value = now.toISOString().substring(0, 7);
    document.getElementById('currentDate').value = now.toISOString().split('T')[0];
    document.getElementById('manualDate').value = now.toISOString().split('T')[0];

    let workData = JSON.parse(localStorage.getItem('work_data_v2') || "{}");
    let timerInterval, startTime = null;

    function renderData() {
        const tbody = document.getElementById('tableBody');
        const rate = parseFloat(document.getElementById('rate').value) || 0;
        const bonus = parseFloat(document.getElementById('bonus').value) || 0;
        const deduct = parseFloat(document.getElementById('totalDeduction').value) || 0;
        const selectedMonth = document.getElementById('monthFilter').value;
        let sumH = 0, totalGross = 0;
        tbody.innerHTML = "";
        Object.keys(workData).sort().reverse().forEach(date => {
            if (date.startsWith(selectedMonth)) {
                const h = parseFloat(workData[date]);
                const isSat = new Date(date).getDay() === 6;
                let np = 0, op = 0;
                if (isSat) { np = Math.min(8, h) * rate * 1.5; op = Math.max(0, h-8) * rate * 1.75; }
                else { np = Math.min(8, h) * rate; op = (Math.max(0, Math.min(2, h-8)) * rate * 1.25) + (Math.max(0, h-10) * rate * 1.5); }
                sumH += h; totalGross += (np + op);
                tbody.innerHTML += `<tr><td>${date.split('-')[2]}/${date.split('-')[1]} ${isSat?'<br><small style="color:red">SAT</small>':''}</td><td>${h.toFixed(2)}</td><td>${Math.round(np)}</td><td style="color:purple">${Math.round(op)}</td><td style="font-weight:bold">‚Ç™${Math.round(np+op)}</td><td><button onclick="deleteItem('${date}')" style="color:#ccc;border:none;background:none">‚úï</button></td></tr>`;
            }
        });
        document.getElementById('totalHDisplay').innerText = sumH.toFixed(2) + " ‡∏ä‡∏°.";
        document.getElementById('grossDisplay').innerText = "‚Ç™" + Math.round(totalGross + bonus).toLocaleString();
        document.getElementById('netDisplay').innerText = Math.round(totalGross + bonus - deduct).toLocaleString();
        localStorage.setItem('work_data_v2', JSON.stringify(workData));
    }

    function backupData() {
        const dataStr = JSON.stringify(workData);
        navigator.clipboard.writeText(dataStr).then(() => {
            alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥‡πÑ‡∏õ '‡∏ß‡∏≤‡∏á' ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ Note ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ LINE ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ");
        });
    }

    function restoreData() {
        const dataStr = prompt("‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:");
        if (dataStr) {
            try {
                const parsed = JSON.parse(dataStr);
                if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö")) {
                    workData = parsed;
                    renderData();
                    alert("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                }
            } catch(e) { alert("‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
        }
    }

    function copySummary() {
        const month = document.getElementById('monthFilter').value;
        const net = document.getElementById('netDisplay').innerText;
        const h = document.getElementById('totalHDisplay').innerText;
        const msg = `üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${month}\n‚è±Ô∏è ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°: ${h}\nüí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ‚Ç™${net}\n(‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡πà‡∏≤‡∏ô Work Pro)`;
        navigator.clipboard.writeText(msg).then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß! ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏™‡πà‡∏á‡πÉ‡∏ô LINE ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"));
    }

    function startWork() {
        startTime = new Date();
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('endBtn').style.display = 'block';
        timerInterval = setInterval(() => {
            const diff = new Date() - startTime;
            const h = Math.floor(diff/3600000).toString().padStart(2,'0');
            const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
            const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
            document.getElementById('timerDisplay').innerText = `${h}:${m}:${s}`;
        }, 1000);
    }

    function endWork() {
        if(!confirm("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô? (‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏Å 30‡∏ô.)")) return;
        const diff = (new Date() - startTime) / 3600000;
        const final = diff > 0.5 ? diff - 0.5 : diff;
        workData[document.getElementById('currentDate').value] = (parseFloat(workData[document.getElementById('currentDate').value] || 0) + final).toFixed(2);
        clearInterval(timerInterval);
        location.reload();
    }

    function saveManual() {
        const d = document.getElementById('manualDate').value;
        const s = new Date(d.replace(/-/g, '/') + ' ' + document.getElementById('timeIn').value);
        let e = new Date(d.replace(/-/g, '/') + ' ' + document.getElementById('timeOut').value);
        if (e <= s) e.setDate(e.getDate() + 1);
        const diff = (e - s) / 3600000 - parseFloat(document.getElementById('manualBreak').value);
        if(diff > 0) { workData[d] = (parseFloat(workData[d] || 0) + diff).toFixed(2); renderData(); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); }
    }

    function deleteItem(d) { if(confirm('‡∏•‡∏ö?')) { delete workData[d]; renderData(); } }
    function clearSystem() { if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) { localStorage.clear(); location.reload(); } }
    renderData();
</script>
</body>
</html>
