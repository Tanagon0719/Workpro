<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Work Pro Israel - Pro V6</title>
    <style>
        :root { --bg: #f0f2f5; --card-bg: #ffffff; --primary: #4e73df; --success: #1cc88a; --danger: #e74a3b; --text-main: #2e3440; --text-sub: #858796; --night: #6f42c1; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding: 20px 15px; }
        .container { max-width: 480px; margin: 0 auto; }
        .card { background: var(--card-bg); border-radius: 18px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.04); margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.02); }
        .card-title { font-size: 0.75rem; font-weight: 800; color: var(--text-sub); text-transform: uppercase; margin-bottom: 12px; display: block; letter-spacing: 0.5px; }
        input, select { background: #f8f9fc; border: 1px solid #d1d3e2; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box; font-size: 1rem; margin-bottom: 10px; outline: none; }
        .timer-display { font-size: 3.2rem; font-weight: 800; text-align: center; margin: 15px 0; color: var(--primary); font-family: monospace; }
        .btn { padding: 16px; border: none; border-radius: 12px; font-weight: 700; width: 100%; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: none; border: 1px solid var(--text-sub); color: var(--text-sub); padding: 10px; font-size: 0.75rem; border-radius: 10px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 0.65rem; color: var(--text-sub); padding: 10px; border-bottom: 1px solid #eaecf4; }
        td { padding: 12px 10px; font-size: 0.85rem; border-bottom: 1px solid #f8f9fc; }
        .summary-card { background: linear-gradient(135deg, #1a1c23, #2d3436); color: white; padding: 25px; border-radius: 22px; text-align: center; margin-top: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .net-amount { font-size: 3rem; font-weight: 800; color: #00ff88; display: block; margin: 5px 0; }
        .badge { font-size: 0.55rem; font-weight: bold; padding: 2px 5px; border-radius: 4px; margin-top: 3px; display: inline-block; }
        .badge-fri { background: #e3f2fd; color: #1976d2; }
        .badge-sat { background: #ffebee; color: #d32f2f; }
        .badge-night { background: #f3e5f5; color: var(--night); }
    </style>
</head>
<body>

<div class="container">
    <div class="card" style="border-left: 5px solid var(--primary);">
        <span class="card-title">üìÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
        <input type="month" id="monthFilter" onchange="renderData()">
    </div>

    <div class="card">
        <span class="card-title">üïí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
        <input type="date" id="currentDate">
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        <div id="timerControls">
            <select id="currentShift">
                <option value="day">‚òÄÔ∏è ‡∏Å‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (OT ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏°. 9)</option>
                <option value="night">üåô ‡∏Å‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô (OT ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏°. 8)</option>
            </select>
            <button id="startBtn" class="btn btn-success" onclick="startWork()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</button>
            <button id="endBtn" class="btn btn-danger" style="display:none;" onclick="endWork()">‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô</button>
        </div>
        <p id="statusLabel" style="text-align:center; font-size:0.75rem; color:var(--text-sub); margin:0;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
    </div>

    <div class="card" style="border: 1px dashed #ccc; background: #fafafa;">
        <span class="card-title">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</span>
        <input type="date" id="manualDate">
        <div class="grid-2">
            <div><label style="font-size:0.6rem">‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="time" id="timeIn" value="06:00"></div>
            <div><label style="font-size:0.6rem">‡πÄ‡∏•‡∏¥‡∏Å</label><input type="time" id="timeOut" value="17:00"></div>
        </div>
        <div class="grid-2">
            <select id="manualShift">
                <option value="day">‚òÄÔ∏è ‡∏Å‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</option>
                <option value="night">üåô ‡∏Å‡∏∞‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô</option>
            </select>
            <input type="number" id="manualBreak" value="0.5" step="0.1" placeholder="‡∏û‡∏±‡∏Å (‡∏ä‡∏°.)">
        </div>
        <button class="btn btn-primary" onclick="saveManual()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
    </div>

    <div class="card">
        <span class="card-title">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
        <div class="grid-2">
            <div><label style="font-size:0.6rem">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏°.</label><input type="number" id="rate" value="38" oninput="renderData()"></div>
            <div><label style="font-size:0.6rem">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</label><input type="number" id="bonus" value="0" oninput="renderData()"></div>
        </div>
        <label style="font-size:0.6rem">‡∏¢‡∏≠‡∏î‡∏´‡∏±‡∏Å‡∏£‡∏ß‡∏° (‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏•‡∏¥‡∏õ)</label>
        <input type="number" id="totalDeduction" value="0" oninput="renderData()">
    </div>

    <div class="card" style="padding: 10px; overflow-x: auto;">
        <table>
            <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏°.</th><th>‡∏õ‡∏Å‡∏ï‡∏¥</th><th>‡πÇ‡∏≠‡∏ó‡∏µ</th><th>‡∏£‡∏ß‡∏°</th><th></th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div class="summary-card">
        <span style="opacity: 0.8; font-size: 0.9rem;">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Pay)</span>
        <span class="net-amount">‚Ç™ <span id="netDisplay">0</span></span>
        <div style="display: flex; justify-content: space-around; font-size: 0.8rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; margin-bottom: 10px;">
            <div>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°: <b id="totalHDisplay">0</b></div>
            <div>‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏Å: <b id="grossDisplay">0</b></div>
        </div>
        <button onclick="copySummary()" style="background:rgba(255,255,255,0.15); border:none; color:white; padding:10px; border-radius:10px; font-size:0.8rem; cursor:pointer; width:100%;">üìã ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏™‡πà‡∏á LINE</button>
    </div>

    <div class="grid-2" style="margin-top: 15px;">
        <button onclick="backupData()" class="btn-outline">üì• ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏•‡∏á Note</button>
        <button onclick="restoreData()" class="btn-outline">üì§ ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
    <button onclick="clearSystem()" style="width:100%; background:none; color:#ccc; border:none; padding: 20px; font-size: 0.7rem;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<script>
    let workData = JSON.parse(localStorage.getItem('work_data_v3') || "{}");
    let timerInterval;

    function renderData() {
        const tbody = document.getElementById('tableBody');
        const rate = parseFloat(document.getElementById('rate').value) || 0;
        const bonus = parseFloat(document.getElementById('bonus').value) || 0;
        const deduct = parseFloat(document.getElementById('totalDeduction').value) || 0;
        const month = document.getElementById('monthFilter').value;
        let sumH = 0, totalPay = 0;
        tbody.innerHTML = "";

        Object.keys(workData).sort().reverse().forEach(d => {
            if (d.startsWith(month)) {
                const entry = workData[d];
                let h = entry.hours, dayIdx = new Date(d).getDay(), isNight = entry.shift === 'night', np, op;
                let labels = "";

                if(dayIdx === 6) { // ‡πÄ‡∏™‡∏≤‡∏£‡πå
                    np = Math.min(8, h) * rate * 1.5; op = Math.max(0, h-8) * rate * 1.75;
                    labels += '<br><span class="badge badge-sat">SAT</span>';
                } else {
                    let limit = isNight ? 7 : 8; // ‡∏Å‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ 7 ‡∏ä‡∏°.
                    np = Math.min(limit, h) * rate;
                    op = (Math.max(0, Math.min(2, h-limit)) * rate * 1.25) + (Math.max(0, h-(limit+2)) * rate * 1.5);
                    if(dayIdx === 5) labels += '<br><span class="badge badge-fri">FRI</span>';
                    if(isNight) labels += '<br><span class="badge badge-night">NIGHT</span>';
                }
                sumH += h; totalPay += (np + op);
                tbody.innerHTML += `<tr><td>${d.split('-')[2]}/${d.split('-')[1]}${labels}</td><td style="font-weight:700">${h.toFixed(2)}</td><td>${Math.round(np)}</td><td>${Math.round(op)}</td><td style="font-weight:bold">‚Ç™${Math.round(np+op)}</td><td onclick="del('${d}')" style="color:#ccc">‚úï</td></tr>`;
            }
        });
        document.getElementById('totalHDisplay').innerText = sumH.toFixed(2);
        document.getElementById('grossDisplay').innerText = "‚Ç™"+Math.round(totalPay+bonus).toLocaleString();
        document.getElementById('netDisplay').innerText = Math.round(totalPay+bonus-deduct).toLocaleString();
        localStorage.setItem('work_data_v3', JSON.stringify(workData));
    }

    function checkRunningTimer() {
        const saved = localStorage.getItem('running_start_time');
        if (saved) {
            const start = new Date(parseInt(saved));
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('endBtn').style.display = 'block';
            document.getElementById('currentShift').style.display = 'none';
            document.getElementById('statusLabel').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤... (‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ)";
            timerInterval = setInterval(() => {
                const diff = new Date() - start;
                const h = Math.floor(diff/3600000).toString().padStart(2,'0');
                const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('timerDisplay').innerText = `${h}:${m}:${s}`;
            }, 1000);
        }
    }

    function startWork() {
        localStorage.setItem('running_start_time', Date.now());
        localStorage.setItem('running_shift', document.getElementById('currentShift').value);
        location.reload();
    }

    function endWork() {
        const d = document.getElementById('currentDate').value;
        const dayIdx = new Date(d).getDay();
        const start = localStorage.getItem('running_start_time');
        const shift = localStorage.getItem('running_shift');
        const diff = (Date.now() - parseInt(start)) / 3600000;
        
        let finalH = (dayIdx !== 5 && diff > 0.5) ? diff - 0.5 : diff;
        let msg = dayIdx === 5 ? "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏°‡πà‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏Å" : "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ (‡∏´‡∏±‡∏Å‡∏û‡∏±‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)";
        
        if(!confirm(msg)) return;
        workData[d] = { hours: parseFloat(finalH.toFixed(2)), shift: shift };
        localStorage.removeItem('running_start_time');
        localStorage.removeItem('running_shift');
        location.reload();
    }

    function saveManual() {
        const d = document.getElementById('manualDate').value;
        const s = new Date(d.replace(/-/g, '/') + ' ' + document.getElementById('timeIn').value);
        let e = new Date(d.replace(/-/g, '/') + ' ' + document.getElementById('timeOut').value);
        if (e <= s) e.setDate(e.getDate() + 1);
        const diff = (e - s) / 3600000 - parseFloat(document.getElementById('manualBreak').value);
        workData[d] = { hours: parseFloat(diff.toFixed(2)), shift: document.getElementById('manualShift').value };
        renderData(); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }

    function backupData() {
        navigator.clipboard.writeText(JSON.stringify(workData)).then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß! ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ Note ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"));
    }

    function restoreData() {
        const data = prompt("‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô:");
        if (data) { try { workData = JSON.parse(data); renderData(); alert("‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); } catch(e) { alert("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); } }
    }

    function copySummary() {
        const msg = `üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${document.getElementById('monthFilter').value}\n‚è±Ô∏è ‡∏ä‡∏°.‡∏£‡∏ß‡∏°: ${document.getElementById('totalHDisplay').innerText} ‡∏ä‡∏°.\nüí∞ ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ‚Ç™${document.getElementById('netDisplay').innerText}\n(‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡πà‡∏≤‡∏ô Work Pro)`;
        navigator.clipboard.writeText(msg).then(() => alert("‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß!"));
    }

    function del(d) { if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { delete workData[d]; renderData(); } }
    function clearSystem() { if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) { localStorage.clear(); location.reload(); } }

    const today = new Date();
    document.getElementById('monthFilter').value = today.toISOString().substring(0, 7);
    document.getElementById('currentDate').value = today.toISOString().split('T')[0];
    document.getElementById('manualDate').value = today.toISOString().split('T')[0];
    checkRunningTimer();
    renderData();
</script>
</body>
</html>
